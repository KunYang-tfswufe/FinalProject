# 项目名称：基于边缘计算的藏红花全生长周期智能培育系统设计与实现

```
智能科技学院2026届本科毕业设计功能实现要求:

1.软硬件系统设计

可设计移动应用系统、基于智能硬件的应用系统、Web应用系统。

具体要求：

（1）能使用所学C/Java/Python等程序设计语言解决相对复杂的综合问题，目标集中，要有较为完整的主体业务逻辑（总体目标）；

（2）要采用合适的分层架构、视图和代码分离（总体架构）；

（3）要考虑系统所需要的用户界面适配显示效果（前端用户接口UI）；

（4）要使用MySQL/SQLServer/Oracle等数据库持久化的功能，其中移动应用系统、Web应用系统至少应包含6张业务逻辑关联数据表，并涉及到存储过程、触发器等技术点的应用（后端存储）；系统页面须实现响应式设计；整个系统须由前端页面和后台管理系统组成，后台管理系统能区分不同角色入口及对应管理权限；

（5）系统应该设计测试用例，通过测试，能反馈系统的稳定性和健壮性（系统测试），说明软/硬件系统核心功能是否达到预期；

（6）以微控制器（单片机51/STM32，推荐型号STM32L431RCT6，不建议使用型号STM32F103C8T6）为核心的智能应用系统，能够采用微控制器编写程序，实现传感器数据采集、设备终端数据显示、存储，系统应具有联网功能、数据通讯、网络控制、数据处理等功能，设备终端硬件需个人独立设计（底板可用面包板设计或PCB设计；各功能模块在底板集成基础上开发并实现对应功能），系统设计时应体现不同方案的对比以及如何完成各器件的选型，设计应贴合具体应用场景，避免同质化套壳设计；

（7）以微处理器（ARM）为核心的智能应用系统，采用ARM处理器编写程序，实现传感器数据采集、设备终端数据显示及存储，系统具有联网功能、数据通讯、网络控制、数据处理等功能，设备终端硬件需个人独立设计（底板可用面包板设计或PCB设计；各功能模块在底板上集成基础上开发并实现对应功能），系统设计时应体现不同方案的对比以及如何完成各器件的选型；

（8）智能物联网应用系统，针对特定的应用场景，采用物联网技术，将传感器、控制器、智能设备、互联网等多种物联网组件进行有机结合，实现对各种物品、设备、场所、人员的智能化管理和监控，要求选用合理的物联网中间件技术、系统运行安全稳定可靠，要求设备端硬件需个人独立设计（底板可用面包板设计，或PCB设计；各功能模块在底板上集成基础上开发并实现对应功能），系统设计时应体现不同方案的对比以及如何完成各器件的选型。

适用专业：计算机科学与技术（1-7）、智能科学与技术（1-8）、物联网工程（1-8）、信息管理与信息系统（1-5）
知网地址:https://co2.cnki.net/Login.html?dp=tfswufe&r=1685087871577
账户为学号例如:42212346
密码例如:let*********3(星号为加密部分)
```

## 项目核心背景信息 (Project Core Context)

为了方便AI/LLM在后续对话中快速理解上下文，以下是截至当前时间点的项目核心背景信息摘要。

- **项目名称:** 基于边缘计算的藏红花全生长周期智能培育系统设计与实现
- **项目目标:** 设计并实现一个集数据采集、边缘处理、云端通信和跨平台应用控制于一体的完整物联网（IoT）智能农业解决方案。
- **核心架构 (四层模型):**
  1.  **感知控制层:** STM32微控制器负责实时采集环境数据（温湿度、光照、土壤湿度）并精确执行控制指令（水泵、补光灯等）。
  2.  **边缘计算层:** 树莓派作为边缘网关，负责与STM32进行串口通信，对数据进行本地存储、预处理和实时分析，并通过Flask提供局域网API服务。
  3.  **云服务层:** 采用MQTT协议，将边缘端处理后的关键数据上报至云端MQTT Broker，并订阅云端下发的控制指令，实现系统的远程监控。
  4.  **应用表现层:** 基于PWA（Progressive Web App）技术的前端应用，可自适应PC和移动设备，实现数据的可视化展现、远程设备控制和用户权限管理。

- **开发者及环境信息:**
  - **开发者操作系统:** **Arch Linux**
  - **嵌入式IDE:** **STM32CubeIDE**
  - **嵌入式调试工具:** **`minicom`** (串口通信测试)
  - **后端语言:** Python 3

- **硬件选型:**
  - **微控制器 (MCU):** `STM32L476RGT6U` (原型开发板: **NUCLEO-L476RG**)
  - **边缘计算设备:** **树莓派4B (Raspberry Pi 4B)**
  - **STM32 <-> 树莓派通信:** **UART串口**

---

## ✅ 项目规划清单 (Project Planning Checklist)

1.  **一句话项目描述:** `这个项目是做什么的？`
    > 答：一个集STM32数据采集、树莓派边缘处理、MQTT云通信和PWA跨平台控制于一体的藏红花智能培育物联网系统。
2.  **目标用户画像:** `我在为谁开发？`
    > 答：小王，一名对现代农业技术充满热情的智能农业专业学生或研究员。他希望通过自动化技术提高藏红花的种植效率和品质，并能随时随地通过手机或电脑（无论在本地还是外网）监控和管理培育环境。
3.  **MVP 功能列表:** `必须实现的核心功能有哪些？`
    > 1.  STM32能采集多路环境数据并上报给树莓派。
    > 2.  树莓派能接收数据、存入本地数据库，并通过API提供给前端。
    > 3.  PWA前端能实时展示来自API的环境数据。
    > 4.  用户能在PWA前端下发控制指令。
    > 5.  STM32能接收并执行树莓派转发来的控制指令。
    > 6.  树莓派能将数据推送到云端MQTT服务器。
4.  **技术栈清单:**
    > - **感知控制层 (STM32):** C语言, STM32 HAL库
    > - **边缘计算层 (树莓派):** Python, Flask, SQLAlchemy, Gunicorn, Paho-MQTT
    > - **云服务层:** 公共/自建 MQTT Broker (如 EMQX, Mosquitto)
    > - **应用表现层 (PWA):** Vue 3 (或 React), ECharts, Element Plus (或 Ant Design)
    > - **数据库:** MySQL (或 MariaDB)
    > - **开发/部署环境:** Arch Linux (开发), Raspberry Pi OS (部署), Nginx
5.  **高层架构图:**
    > ```
    > [ 感知控制层 ]          [ 边缘计算层 ]             [ 云服务层 ]             [ 应用表现层 ]
    > +-------------+        +----------------------+   +--------------+         +--------------+
    > | STM32       | UART   | Raspberry Pi         |   | MQTT Broker  |         | PWA          |
    > | + 传感器   | <------> | + Python Serial      |   |              |         | (PC/Mobile)  |
    > | + 执行器   |        | + Flask API (Local)  |---| (Internet) |---------|              |
    > +-------------+        | + MariaDB            |   |              |         +--------------+
    >                        | + MQTT Client        |---/              |
    >                        +----------------------+
    > ```
6.  **核心数据模型/表结构:** `项目的数据骨架，满足6张表要求。`
    > 答：详见下文 **“核心数据模型 (数据库设计)”** 章节。
7.  **主要页面线框图:**
    > - **登录页:** 用户名、密码输入。
    > - **数据仪表盘 (Dashboard):** 实时数据显示卡片、设备状态、ECharts实时曲线图、快捷控制开关。
    > - **历史数据页:** 按日期/时间范围查询历史数据，并以图表和表格形式展示。
    > - **后台管理页 (Admin):** 用户管理、角色权限分配、设备管理。
8.  **任务列表/看板:**
    > 答：见下文的 **“敏捷开发冲刺计划”**，已分解为四周的冲刺任务。
9.  **一个优秀的 README.md 草稿:**
    > 答：本文档本身即为项目 README 的持续演进版本。

---

## 的核心数据模型 (数据库设计)

为满足毕业设计要求，系统设计以下6张核心数据表，均采用MySQL/MariaDB存储。

1.  **用户表 (users)**
    - `id` (INT, PK, AI): 用户ID
    - `username` (VARCHAR, UNIQUE): 用户名
    - `password_hash` (VARCHAR): 加密后的密码
    - `email` (VARCHAR, UNIQUE): 电子邮箱
    - `created_at` (DATETIME): 创建时间

2.  **角色表 (roles)**
    - `id` (INT, PK, AI): 角色ID
    - `role_name` (VARCHAR, UNIQUE): 角色名称 (如 'admin', 'observer')

3.  **用户角色关联表 (user_roles)**
    - `user_id` (INT, FK -> users.id): 用户ID
    - `role_id` (INT, FK -> roles.id): 角色ID

4.  **设备表 (devices)**
    - `id` (INT, PK, AI): 设备ID
    - `device_name` (VARCHAR): 设备名称 (如 '一号培育箱')
    - `location` (VARCHAR): 物理位置
    - `status` (VARCHAR): 设备状态 ('online', 'offline')
    - `last_seen` (DATETIME): 最后在线时间

5.  **传感器数据表 (sensor_data)**
    - `id` (BIGINT, PK, AI): 数据记录ID
    - `device_id` (INT, FK -> devices.id): 所属设备ID
    - `timestamp` (DATETIME, INDEX): 采集时间戳
    - `temperature` (FLOAT): 温度 (°C)
    - `humidity` (FLOAT): 湿度 (%)
    - `light_intensity` (FLOAT): 光照强度 (lux)
    - `soil_moisture` (FLOAT): 土壤湿度 (%)

6.  **控制日志表 (control_logs)**
    - `id` (BIGINT, PK, AI): 日志ID
    - `user_id` (INT, FK -> users.id): 操作用户ID
    - `device_id` (INT, FK -> devices.id): 被控设备ID
    - `actuator` (VARCHAR): 被控执行器 (如 'water_pump', 'led_light')
    - `action` (VARCHAR): 执行动作 (如 'ON', 'OFF')
    - `timestamp` (DATETIME): 操作时间
    - `result` (VARCHAR): 执行结果 ('success', 'failed')

---

## 🚀 敏捷开发冲刺计划 (Agile Development Sprint Plan)

鉴于项目周期仅有一个月，我们采用**敏捷迭代**的开发模式，以**周**为单位进行冲刺（Sprint）。

### **第一周：核心链路贯通 (The "Tracer Bullet" Sprint)**

**🎯 本周目标：** 跑通一个最简化的端到端**局域网**流程。实现从传感器采集数据，通过树莓派，最终显示在一个极简的网页上。这是整个项目的“龙骨”，优先级最高。

- [ ] **任务 1.1 (硬件):** STM32 初始化与传感器驱动
  - [ ] 使用 STM32CubeMX 配置时钟和 UART。
  - [ ] 编写代码驱动一个传感器（如 DHT22 温湿度传感器）。
- [ ] **任务 1.2 (硬件):** 基础数据发送
  - [ ] STM32 定时读取传感器数据，格式化成 JSON 字符串 (例如 `{"temp": 25.5, "humi": 60.1}`)。
  - [ ] 通过 UART 将此字符串发送出去。
  - [ ] **验证:** 在 Arch Linux 上用 `minicom` 确认能收到格式正确的数据。
- [ ] **任务 1.3 (边缘计算):** 基础数据接收
  - [ ] 在树莓派上编写一个 Python 脚本 (`pyserial`) 读取串口数据并打印。
  - [ ] **验证:** 确认脚本能正确接收并解析来自 STM32 的数据。
- [ ] **任务 1.4 (后端):** 最简 API 服务
  - [ ] 搭建一个基础的 Flask 应用。
  - [ ] 将串口读取逻辑放入一个后台线程，并将最新数据暂存到全局变量。
  - [ ] 创建 API 端点 `GET /api/v1/sensors/latest`，返回最新数据。
  - [ ] **验证:** 用 `curl http://<树莓派IP>:5000/api/v1/sensors/latest` 确认能获取 JSON 数据。
- [ ] **任务 1.5 (前端):** 最简数据显示
  - [ ] 创建一个 `index.html`，用原生 JavaScript 的 `fetch` 定时调用树莓派 API，并将数据显示在页面上。
  - [ ] **验证:** 浏览器中能看到来自传感器的实时数据刷新。

**✅ 周末复盘:** 我们应该有了一个能工作的局域网原型，证明了硬件->边缘->前端的技术链路可行。

---

### **第二周：MVP 功能完善 (The MVP Feature Sprint)**

**🎯 本周目标：** 在核心链路基础上，扩展 MVP 功能。实现所有传感器的数据化、基础的设备反向控制和数据持久化。

- [ ] **任务 2.1 (硬件):** 功能扩展与反向控制
  - [ ] 集成所有传感器（光照、土壤湿度等），扩展上报的 JSON 数据结构。
  - [ ] 编写 GPIO 控制代码驱动一个执行器（如继电器控制的水泵）。
  - [ ] 实现 UART 接收和命令解析，能根据 JSON 命令（如 `{"actuator": "pump", "action": "on"}`）控制执行器。
- [ ] **任务 2.2 (后端):** 数据库集成
  - [ ] 在树莓派上安装并配置好 MariaDB/MySQL。
  - [ ] 在 Flask 中使用 SQLAlchemy 定义 `devices` 和 `sensor_data` 模型。
  - [ ] 修改后台线程，将收到的每条传感器数据存入数据库。
- [ ] **任务 2.3 (后端):** 控制 API
  - [ ] 创建 `POST /api/v1/control` API，接收前端的控制指令。
  - [ ] API 将指令转换为与 STM32 约定的格式，通过串口发送，并将操作记录存入 `control_logs` 表（此时user_id可暂为null）。
- [ ] **任务 2.4 (前端):** 基础仪表盘
  - [ ] 使用 Vue 或 React 初始化前端项目，引入 UI 库。
  - [ ] 创建一个仪表盘页面，用卡片和图表组件展示所有传感器的实时数据。
  - [ ] 添加控制按钮，点击时调用后端的控制 API。
- [ ] **任务 2.5 (集成测试):**
  - [ ] 端到端测试：在网页上点击按钮，观察 STM32 上的继电器是否动作。
  - [ ] 数据库验证：检查 `sensor_data` 表中是否有持续写入的新数据。

**✅ 周末复盘:** 我们应该有了一个功能基本完整的局域网监控系统原型。

---

### **第三周：云端通信与用户体验 (The Cloud & UX Sprint)**

**🎯 本周目标：** 将原型完善成一个真正的应用。重点是用户系统、云端通信、历史数据可视化和界面美化，满足毕业设计的核心软件要求。

- [ ] **任务 3.1 (后端):** 用户系统 (RBAC)
  - [ ] 设计并创建 `users`, `roles`, `user_roles` 表。
  - [ ] 实现用户注册、登录 API，使用 JWT (JSON Web Tokens) 进行认证。
  - [ ] 创建 API 保护装饰器，实现不同角色（管理员/普通用户）对 API 的访问控制。
- [ ] **任务 3.2 (后端):** 历史数据 API
  - [ ] 创建 `GET /api/v1/sensors/history` API，支持按时间范围从数据库查询数据。
- [ ] **任务 3.3 (后端/云端):** MQTT 集成
  - [ ] 在树莓派的 Python 程序中集成 `paho-mqtt` 客户端。
  - [ ] 将接收到的传感器数据定时发布 (Publish) 到指定的 MQTT Topic。
  - [ ] 订阅 (Subscribe) 控制指令 Topic，接收来自云端的指令并转发给 STM32。
- [ ] **任务 3.4 (前端):** 用户流程与历史数据
  - [ ] 创建登录页面，实现完整的登录/登出流程。
  - [ ] 创建历史数据页面，使用 ECharts 调用历史 API，将数据可视化展示。
- [ ] **任务 3.5 (前端):** 后台管理与 PWA
  - [ ] 创建一个简单的后台管理界面（仅管理员可见），用于用户和设备管理。
  - [ ] 实现响应式布局，确保在手机和桌面端都有良好体验。
  - [ ] 配置 PWA 所需的 `manifest.json` 和 `Service Worker`，实现应用可“安装”到桌面。
- [ ] **任务 3.6 (数据库):**
  - [ ] 根据毕设要求，设计并实现一个存储过程（如：用于批量清理N天前的数据）和一个触发器（如：当设备状态变为offline时记录一条告警日志）。

**✅ 周末复盘:** 系统已具备完整的用户体系、远程访问能力和数据展现能力，软件部分已基本满足毕设要求。

---

### **第四周：测试、部署与文档 (The Polish, Deploy & Document Sprint)**

**🎯 本周目标：** 稳定系统，完成部署，并集中精力撰写毕业设计文档和论文。**本周不应再开发新功能。**

- [ ] **任务 4.1 (测试):** 系统健壮性测试
  - [ ] 编写核心功能的测试用例（如用户登录、远程控制、数据上报）。
  - [ ] 进行异常测试（如拔掉串口、树莓派断网），确保系统能妥善处理并恢复。
- [ ] **任务 4.2 (部署):** 生产环境部署
  - [ ] 使用 Gunicorn 和 Nginx 在树莓派上部署 Flask 应用，提高性能和稳定性。
  - [ ] 配置 `systemd` 服务，实现 Python 后端服务和串口监听脚本的开机自启动。
- [ ] **任务 4.3 (硬件):** 定型
  - [ ] （如果时间允许）将电路从面包板焊接到洞洞板或定制PCB上，使其更稳固、更专业。
- [ ] **任务 4.4 (文档):** 论文与答辩准备
  - [ ] 绘制系统架构图、数据流图、E-R 图、UML用例图等。
  - [ ] 集中精力撰写毕业论文的系统设计、实现和测试章节。
  - [ ] 准备答辩 PPT 和现场演示脚本。
- [ ] **任务 4.5 (代码整理):**
  - [ ] 清理代码，添加必要的注释，统一代码风格。
  - [ ] 最终完善 `README.md`，包含项目介绍、技术栈、部署说明和系统截图。

**✅ 项目完成:** 一个稳定、可演示、文档齐全、满足所有毕业设计要求的完整项目。
