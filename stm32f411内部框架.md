### STM32F411xC/xE 微控制器架构框图（基于 MSv34920V2）

本文档提供了对 STM32F411xC/xE 微控制器内部架构的文字描述，旨在提供详尽、结构化的上下文信息。

#### 1. 总体架构

该微控制器围绕一个高性能的 **`AHB bus-matrix`**（7个主设备/4个从设备）构建。该总线矩阵连接了高性能的 ARM 内核、DMA 控制器、存储器，并通过总线桥（`AHB/APB` bridges）连接到各种外设。

#### 2. 核心与系统组件

- **CPU 核心**:
  - **ARM Cortex-M4 内核**，集成 **FPU**（浮点运算单元），最高频率 **100 MHz**。
  - 通过 `I-BUS` (指令总线)、`D-BUS` (数据总线) 和 `S-BUS` (系统总线) 连接到总线矩阵。
  - 内置 **`MPU`** (内存保护单元) 和 **`NVIC`** (嵌套向量中断控制器)。

- **存储器**:
  - **512 KB Flash 闪存**，配备**加速器/缓存 (`ACCEL/CACHE`)**，实现高速访问。
  - **128 KB SRAM**。

- **DMA (直接存储器访问) 控制器**:
  - `DMA1`: 8 个数据流 (Streams) 和一个 FIFO。
  - `DMA2`: 8 个数据流 (Streams) 和一个 FIFO。
  - 二者均为主设备，可直接访问存储器和外设。

- **调试与追踪**:
  - 支持 **`JTAG` & `SWD`** (串行线调试) 接口。
  - **`ETM`** (嵌入式追踪宏单元)。
  - 外部信号: `NJTRST`, `JTDI`, `JTCK/SWCLK`, `JTDO/SWD`, `TRACECLK`, `TRACED[3:0]`。

- **CRC 计算单元**:
  - 连接到 `AHB1` 总线的硬件 CRC 模块。

#### 3. 复位、时钟与电源管理

- **复位与时钟控制 (Reset & clock control)**:
  - 管理系统所有时钟，如 `HCLK`, `APB1CLK`, `APB2CLK`。
  - 时钟源包括:
    - **XTAL OSC**: 4-16 MHz 高速外部晶振 (`OSC_IN`, `OSC_OUT`)。
    - **RC HS/LS**: 内部高速/低速 RC 振荡器。
    - **PLL1 & PLL2**: 锁相环，用于倍频以产生高速系统时钟。
    - **32 kHz LSE**: 外部低速晶振 (`OSC32_IN`, `OSC32_OUT`)，主要用于 RTC。

- **电源管理 (Power managmnt)**:
  - **主电源 (`VDD`)**: 1.7V 至 3.6V (PDR OFF) / 1.8V 至 3.6V (PDR ON)。
  - **内部电压调节器**: 为 1.2V 内核供电。
  - **供电监控**: 包括 `POR/PDR` (上电/掉电复位)、`BOR` (欠压复位) 和 `PVD` (可编程电压检测器)。
  - **备用电源 (`VBAT`)**: 1.65V 至 3.6V，为 `RTC` 和备份域供电。

- **RTC (实时时钟) 与备份域**:
  - 包含 `RTC`、`AWU` (自动唤醒单元) 和备份寄存器。
  - 输出信号: `ALARM_OUT`, `STAMP1`。

- **看门狗 (Watchdogs)**:
  - **独立看门狗 (`IWDG`)**: 由专用的 32 kHz 内部振荡器 (`WDG 32K`) 驱动。
  - **窗口看门狗 (`WWDG`)**: 连接在 `APB1` 总线上。

---

#### 4. 总线与外设

##### **AHB2 总线 (100 MHz)**

- **`USB OTG FS` (On-The-Go Full-Speed)**:
  - 集成 **PHY** (物理层) 和 FIFO。
  - 外部信号: `DP`, `DM`, `ID`, `VBUS`, `SOF`。

##### **AHB1 总线 (100 MHz)**

- **GPIO 端口**: `GPIOA` 至 `GPIOE` (PA[15:0] - PE[15:0]), `GPIOH` (PH[1:0])。
- **`CRC`**: CRC 计算单元。
- **总线桥**: 连接到 `APB1` 和 `APB2` 总线。

##### **APB2 总线 (最高 100 MHz)**

_高速外设总线_

- **定时器**:
  - `TIM1`: 16位高级定时器 (4通道, 3互补通道, `ETR`, `BKIN`)。
  - `TIM9`: 16位通用定时器 (2通道)。
  - `TIM10`, `TIM11`: 16位通用定时器 (各1通道)。
- **通信接口**:
  - `USART1`, `USART6`: 支持 `smcard`, `IrDA`。信号: `RX, TX, CK, CTS, RTS` (AF)。
  - `SPI1`, `SPI4`, `SPI5` (可配置为 `I2S1`, `I2S4`, `I2S5`)。信号: `MOSI/SD, MISO/SD_ext, SCK/CK, NSS/WS` (AF)。
- **模拟**:
  - `ADC1`: 12位，**16个模拟输入**通道，内置**温度传感器**。
- **存储与外部事件**:
  - `SDIO / MMC`: SD卡和MMC卡接口，带FIFO。信号: `D[7:0], CMD, CK` (AF)。
  - `EXTI`: 外部中断/事件控制器 (最多 81 个复用功能)。

##### **APB1 总线 (最高 50 MHz)**

_低速外设总线_

- **定时器**:
  - `TIM2`, `TIM5`: 32位通用定时器 (4通道)。
  - `TIM3`, `TIM4`: 16位通用定时器 (4通道, 支持 `ETR`)。
- **通信接口**:
  - `USART2`: 支持 `smcard`, `IrDA`。信号: `RX, TX, CTS, RTS` (AF)。
  - `SPI2`, `SPI3` (可配置为 `I2S2`, `I2S3`)。信号: `MOSI/SD, MISO/SD_ext, SCK/CK, NSS/WS, MCK` (AF)。
  - `I2C1`, `I2C2`, `I2C3` (支持 `SMBUS`)。信号: `SCL, SDA, SMBA` (AF)。
- **系统**:
  - `WWDG`: 窗口看门狗。
  - `PWR interface`: 电源控制接口。

---

#### 5. 图表脚注说明

1.  根据图表下方的注释：连接到 `APB2` 总线的定时器 (`TIM1, 9, 10, 11`)，其时钟源 (`TIMxCLK`) 频率最高可达 **100 MHz**；而连接到 `APB1` 总线的定时器 (`TIM2, 3, 4, 5`)，其时钟源频率最高可达 **50 MHz**。
